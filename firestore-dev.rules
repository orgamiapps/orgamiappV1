rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // DEVELOPMENT RULES - More permissive for testing
    // WARNING: Do not use in production!
    
    // Organizations collection rules
    match /Organizations/{orgId} {
      // Allow read/write for all authenticated users
      allow read, write: if isAuthenticated();
      
      // Members subcollection
      match /Members/{memberId} {
        allow read, write: if isAuthenticated();
      }
      
      // Feed subcollection - PERMISSIVE for testing
      match /Feed/{feedId} {
        // Allow all authenticated users to read and write
        allow read, write: if isAuthenticated();
      }
      
      // Join Requests subcollection
      match /JoinRequests/{requestId} {
        allow read, write: if isAuthenticated();
      }
    }
    
    // Events collection rules
    match /Events/{eventId} {
      allow read, write: if isAuthenticated();
      
      match /Attendees/{attendeeId} {
        allow read, write: if isAuthenticated();
      }
    }
    
    // Users/Customers collection rules
    match /Customers/{userId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && request.auth.uid == userId;
      
      match /{subcollection}/{document} {
        allow read, write: if isAuthenticated() && request.auth.uid == userId;
      }
    }
    
    // Messages collection rules
    match /Messages/{messageId} {
      allow read, write: if isAuthenticated();
      
      match /messages/{subMessageId} {
        allow read, write: if isAuthenticated();
      }
    }
    
    // Temporary catch-all for development
    match /{document=**} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
  }
}
